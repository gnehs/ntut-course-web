(window.webpackJsonp=window.webpackJsonp||[]).push([[16,3],{355:function(t,e,r){var content=r(359);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(55).default)("674cc7b6",content,!0,{sourceMap:!1})},357:function(t,e,r){"use strict";r.r(e);var n={name:"card",props:{to:{type:String}}},o=(r(358),r(35)),component=Object(o.a)(n,(function(){var t=this,e=t.$createElement;return(t._self._c||e)(t.to?"router-link":"div",{tag:"div",staticClass:"card",attrs:{to:t.to}},[t._t("default")],2)}),[],!1,null,null,null);e.default=component.exports},358:function(t,e,r){"use strict";r(355)},359:function(t,e,r){var n=r(54)(!1);n.push([t.i,".card{background:rgba(var(--vs-background),1);color:#2c3e50;color:var(--vs-text);width:100%;box-shadow:0 5px 20px 0 rgba(0,0,0,.05);box-shadow:0 5px 20px 0 rgba(0,0,0,var(--vs-shadow-opacity,.05));border-radius:8px;transition:all .25s ease;position:relative;padding:8px 12px;overflow:hidden;text-decoration:none}.card[disabled]{pointer-events:none}.card:not(.hoverable){border:1px solid rgba(var(--vs-text),.1);box-shadow:none}.card.borderless{box-shadow:none;border:none;background:transparent;padding:4px 0}.card.padding{padding:12px 16px}.card.hoverable{cursor:pointer}.card.hoverable>i{transform:translateY(25%) scale(.95)}.card.hoverable:hover{box-shadow:0 10px 20px 0 rgba(0,0,0,.05);box-shadow:0 10px 20px 0 rgba(0,0,0,var(--vs-shadow-opacity,.05));transform:translateY(-5px);color:var(--vs-text)}.card.hoverable:hover>i{opacity:.4;transform:none}.card.hoverable:active{box-shadow:0 0 0 0 transparent;box-shadow:0 0 0 0 rgba(0,0,0,var(--vs-shadow-opacity,0));transform:translateY(5px)}.card.hoverable:active>i{opacity:.4;transform:translateY(20%)}.card p{margin:0;opacity:.8;font-size:.85rem}.card p+p{margin-top:8px}.card>i{position:absolute;bottom:0;right:.1em;font-size:48px;opacity:.2;transition:all .25s ease;margin:auto;transform-origin:bottom right}",""]),t.exports=n},381:function(t,e,r){"use strict";var n=r(3),o=r(382);n({target:"String",proto:!0,forced:r(383)("link")},{link:function(t){return o(this,"a","href",t)}})},382:function(t,e,r){var n=r(5),o=r(32),c=r(15),l=/"/g,d=n("".replace);t.exports=function(t,e,r,n){var v=c(o(t)),f="<"+e;return""!==r&&(f+=" "+r+'="'+d(c(n),l,"&quot;")+'"'),f+">"+v+"</"+e+">"}},383:function(t,e,r){var n=r(7);t.exports=function(t){return n((function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3}))}},390:function(t,e,r){var content=r(410);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(55).default)("2c19c404",content,!0,{sourceMap:!1})},409:function(t,e,r){"use strict";r(390)},410:function(t,e,r){var n=r(54)(!1);n.push([t.i,".con-checkbox{flex-direction:column;align-items:flex-start}",""]),t.exports=n},455:function(t,e,r){"use strict";r.r(e);r(46),r(47),r(30),r(49),r(31);var n=r(6),o=(r(13),r(56),r(36),r(64),r(65),r(233),r(25),r(116),r(73),r(41),r(26),r(48),r(115),r(88),r(37),r(381),r(40),r(194));function c(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return l(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,d=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return c=t.done,t},e:function(t){d=!0,o=t},f:function(){try{c||null==r.return||r.return()}finally{if(d)throw o}}}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}var d={head:function(){return{title:"新增到行事曆"}},data:function(){return{courseData:[],selectedCourse:[],timetable:{1:{start:"8:10",end:"9:00"},2:{start:"9:10",end:"10:00"},3:{start:"10:10",end:"11:00"},4:{start:"11:10",end:"12:00"},N:{start:"12:10",end:"13:00"},5:{start:"13:10",end:"14:00"},6:{start:"14:10",end:"15:00"},7:{start:"15:10",end:"16:00"},8:{start:"16:10",end:"17:00"},9:{start:"17:10",end:"18:00"},A:{start:"18:30",end:"19:20"},B:{start:"19:20",end:"20:10"},C:{start:"20:20",end:"21:10"},D:{start:"21:10",end:"22:00"}},until:null}},created:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getMyCourse();case 2:return e.next=4,t.getCalendar();case 4:case"end":return e.stop()}}),e)})))()},methods:{getCalendar:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r,n,o,c,l,d,v,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://gnehs.github.io/ntut-course-crawler-node/calendar.json").then((function(t){return t.json()}));case 2:r=e.sent,n=r.filter((function(t){return t.summary.includes("開學")})).map((function(t){return t.start})),o=r.filter((function(t){return"期末考試"==t.summary})).map((function(t){return t.end})),c=t.$store.state,l=c.year,d=c.sem,l=parseInt(l)+1911,"2"==d&&(l+=1),"1"==d?(f=new Date(l,7,2),v=new Date(l+1,0,2)):(f=new Date(l,0,2),v=new Date(l,4,31)),f=n.find((function(t){return new Date(t)>=f})),v=o.find((function(t){return new Date(t)>=v})),t.start=f.split("T")[0],t.until=v.split("T")[0];case 13:case"end":return e.stop()}}),e)})))()},getMyCourse:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r,n,o,c,l,d,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.$store.state,n=r.year,o=r.sem,c=r.department,l="my-couse-data-".concat(n,"-").concat(o),"main"!=c&&(l+="-".concat(c)),d=JSON.parse(localStorage[l]||"[]"),e.next=6,t.$fetchCourse(n,o,c);case 6:v=e.sent,t.courseData=v.filter((function(t){return d.includes(t.id)})).map((function(t){return{courseType:t.courseType,name:t.name.zh,description:t.description.zh,time:t.time,teacher:t.teacher.map((function(t){return t.name})).join("、").trimEllip(13),classroom:t.classroom.map((function(t){return t.name})).join("、").trimEllip(13),link:"https://ntut-course.gnehs.net/course/".concat(n,"/").concat(o,"/").concat(t.id)}})),t.selectedCourse=JSON.parse(JSON.stringify(t.courseData));case 9:case"end":return e.stop()}}),e)})))()},addToCalendar:function(){try{window.gtag("event","download_calendar",{event_category:"calendar",event_label:"download_calendar",value:this.selectedCourse.length})}catch(t){}var t=this.$store.state,e=t.year,r=t.sem;e=parseInt(e)+1911,"2"==r&&(e+=1);var n=this.until;this.$ics.removeAllEvents();var l,d=c(this.selectedCourse);try{for(d.s();!(l=d.n()).done;)for(var v=l.value,f=0,m=Object.keys(v.time);f<m.length;f++){var h=m[f],time=v.time[h];if(0!=time.length){var _=this.timetable[time[0]].start,y=this.timetable[time[time.length-1]].end,x=new Date(this.start);x.setDate(x.getDate()+((7-x.getDay())%7+1)%7);var w={mon:x,tue:new Date(x.getTime()+864e5),wed:new Date(x.getTime()+1728e5),thu:new Date(x.getTime()+2592e5),fri:new Date(x.getTime()+3456e5),sat:new Date(x.getTime()+432e6),sun:new Date(x.getTime()+5184e5)},D=new Date(e,w[h].getMonth(),w[h].getDate(),_.split(":")[0],_.split(":")[1]),C=new Date(e,w[h].getMonth(),w[h].getDate(),y.split(":")[0],y.split(":")[1]),S={language:"zh-TW",subject:v.name,description:v.description,location:v.classroom,begin:D.toISOString(),stop:C.toISOString(),url:v.link,organizer:{name:"北科課程好朋友"},rrule:{freq:"WEEKLY",until:n,interval:1}};this.$ics.addEvent(S.language,S.subject,S.description,S.location,S.begin,S.stop,S.url,S.organizer,S.rrule)}}}catch(t){d.e(t)}finally{d.f()}var E=this.$store.state.year,k=this.$ics.calendar(),A="".concat(E," 學年度").concat("1"==r?"上":"下","學期課程");k=k.replace("\nBEGIN:VCALENDAR","BEGIN:VCALENDAR\nVERSION:2.0\nX-WR-CALNAME:".concat(A,"\nX-WR-CALDESC:").concat("行事曆資訊由北科課程好朋友產生","\nX-WR-TIMEZONE:Asia/Taipei"));var $=new Blob([k],{type:"text/calendar;charset=utf-8"});Object(o.saveAs)($,"".concat(E,"-").concat(r,"-course.ics"))}}},v=(r(409),r(35)),component=Object(v.a)(d,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("h1",[t._v("新增到行事曆")]),t._v(" "),r("p",[t._v("注意：如果你變更了課程，需要重新新增課程到行事曆！")]),t._v(" "),t.courseData.length?t._e():r("vs-alert",{attrs:{color:"danger"},scopedSlots:t._u([{key:"title",fn:function(){return[t._v("沒有課程資料")]},proxy:!0}],null,!1,1917420833)},[t._v("\n    請先新增課程資料\n  ")]),t._v(" "),t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),r("div",{staticClass:"con-checkbox"},t._l(t.courseData,(function(e,i){return r("vs-checkbox",{key:i,attrs:{val:e},model:{value:t.selectedCourse,callback:function(e){t.selectedCourse=e},expression:"selectedCourse"}},[t._v(t._s(e.name))])})),1),t._v(" "),t._m(3),t._v(" "),r("p",[t._v("建議建立專用的行事曆，未來若需移除課程時僅需刪除該行事曆即可。")]),t._v(" "),t._m(4),t._v(" "),r("p",[t._v("這裡通常會自動填上開學日與最後上課日，若有誤請自行修改。")]),t._v(" "),r("div",{staticClass:"cards"},[r("card",[r("p",[t._v("開學日")]),t._v(" "),r("vs-input",{attrs:{type:"date"},model:{value:t.start,callback:function(e){t.start=e},expression:"start"}})],1),t._v(" "),r("card",[r("p",[t._v("最後上課日")]),t._v(" "),r("vs-input",{attrs:{type:"date"},model:{value:t.until,callback:function(e){t.until=e},expression:"until"}})],1)],1),t._v(" "),t._m(5),t._v(" "),r("p",[t._v("輕觸「匯入」按鈕以繼續，匯入流程根據系統與提供商有所不同，請查詢行事曆提供商之說明來了解如何匯入。")]),t._v(" "),r("vs-button",{attrs:{disabled:!t.selectedCourse.length,color:"primary"},on:{click:t.addToCalendar}},[t._v("匯入")]),t._v(" "),r("h2",[t._v("已知問題")]),t._v(" "),r("p",[t._v("目前尚未撰寫跳過連假的功能，因此遇到連假時行事曆上仍會有課程。")])],1)}),[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("h2",[r("span",{staticStyle:{color:"rgb(var(--vs-primary))"}},[t._v("Step 0")]),t._v(" 加入課程\n  ")])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("p",[t._v("\n    請先將你本學期的課程新增到\n    "),r("strong",[t._v("北科課程好朋友")])])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("h2",[r("span",{staticStyle:{color:"rgb(var(--vs-primary))"}},[t._v("Step 1")]),t._v(" 請選擇要加入的課程\n  ")])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("h2",[r("span",{staticStyle:{color:"rgb(var(--vs-primary))"}},[t._v("Step 2")]),t._v(" 新增專用行事曆\n  ")])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("h2",[r("span",{staticStyle:{color:"rgb(var(--vs-primary))"}},[t._v("Step 3")]),t._v(" 填寫行程期間\n  ")])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("h2",[r("span",{staticStyle:{color:"rgb(var(--vs-primary))"}},[t._v("Step 4")]),t._v(" 匯入至行事曆\n  ")])}],!1,null,null,null);e.default=component.exports;installComponents(component,{Card:r(357).default})}}]);